                         ┌──────────────────────────────────────────────────┐
                         │                  User (Browser)                  │
                         │        Streamlit UI (chat, upload, settings)     │
                         └───────────────▲───────────────────▲──────────────┘
                                         │                   │
                                  (query text)        (doc uploads)
                                         │                   │
                                         │                   │
┌────────────────────────────────────────┴───────────────────┴─────────────────────────────────────────┐
│                                      Streamlit App (WSL)                                             │
│                                                                                                      │
│   ┌───────────────┐        ┌──────────────────┐        ┌────────────────────────── ┐                 │
│   │ Session/State │        │  Ingestion Flow  │        │   Retrieval Orchestrator  │                 │
│   │ (chat memory) │        │  - Loaders:      │        │   - Dense K               │                 │
│   └───────┬───────┘        │    PDF/TXT/MD    │        │   - (opt) BM25 K          │                 │
│           │                │  - Chunking      │        │   - Merge/RRF             │                 │
│           │                │  - Embeddings    │        │   - (opt) Reranker        │                 │
│           │                └─────────┬────────┘        └─────────── ┬──────────────┘                 │
│           │                          │                              │                                │
│           │                          ▼                              ▼                                │
│           │                ┌────────────────┐              ┌────────────────────────┐                │
│           │                │  Embeddings    │              │   Retriever (Chroma)   │                │
│           │                │  (Ollama API)  │              │  K docs (+ filters)    │                │
│           │                └───────┬────────┘              └───────────┬────────────┘                │
│           │                        │                                   │                             │
│           │                        ▼                                   ▼                             │
│           │                ┌────────────────┐                 ┌─────────────────────┐                │
│           │                │  Vector Store  │<──persist──────>│  Chroma DB (WSL)    │                │
│           │                └────────────────┘                 └─────────────────────┘                │
│           │                                                                                          │
│           │                                   ┌────────────────────────────┐                         │
│           │                                   │  (opt) Cross-Encoder       │                         │
│           │                                   │  Reranker (bge-base, GPU)  │                         │
│           │                                   └───────────▲────────────────┘                         │
│           │                                               │                                          │
│           │                                  rerank top-N │                                          │
│           │                                               │                                          │
│           │                                  ┌────────────┴────────────┐                             │
│           │                                  │ Prompt Builder          │                             │
│           │                                  │ - System + templates    │                             │
│           │                                  │ - Inserts citations     │                             │
│           │                                  └────────────┬────────────┘                             │
│           │                                               │                                          │
│           │                                        prompt │ + context                                │
│           │                                               ▼                                          │
│           │                                   ┌──────────────────────────┐                           │
│           └──────────────────────────────────►│    LLM (Ollama, WSL)     │                           │
│                                               │  e.g., llama3.1:8b (GPU) │                           │
│                                               └────────────┬─────────────┘                           │
│                                                                                                      │                                           
│                                                     answer + sources                                 │                                           
│                                                            ▼                                           
│                                               ┌──────────────────────────┐                            
│                                               │  Streamlit Response      │  ◄───── shows answer +     
│                                               │  - Answer w/ citations   │         expandable sources 
│                                               │  - Latency, settings     │                            
│                                               └──────────────────────────┘                            
│                                                                                                      │
│   ┌───────────────────────────┐     ┌──────────────────────────┐     ┌───────────────────────────┐   │
│   │  Config & Secrets (.env)  │     │  Observability (future)  │     │   Eval (RAGAS, future)    │   │
│   │  OLLAMA_HOST=127.0.0.1    │     │  basic logs/metrics      │     │  faithfulness, relevance  │   │
│   └───────────────────────────┘     └──────────────────────────┘     └───────────────────────────┘   │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
